# [ [[Java]] ] Java Virtual Machine
## JVM(Java Virtual Machine)
> [!note] JVM이란?
> 자바 가상 머신, **자바 프로그램 실행환경을 만들어주는 소프트웨어**이다. 자바 코드를 컴파일해서 .class 바이트 코드로 만들면 이 코드는 자바 가상 머신 환경에서 실행된다. JVM은 자바 실행 환경(JRE)에 포함되어 있다

> - **바이트 코드** : .class 파일은 바이트 코드라고 하는데 사람이 쓰는 자바 코드와 컴퓨터가 읽는 기계어의 중간 단계

## JVM 특징
> [!note] 장점
> JVM은 플렛폼 독립적으로 JVM이 실행가능한 환경이라면 어디서든 Java 프로그램이 실행 될 수 있도록 한다.

![[Pasted image 20231004102257.png]]

>예를 들어 C언어로 작성된 경우 Test.c를 윈도우 컴파일러를 사용해 컴파일 하면 test.exe가 생성되는데 이는 윈도우 컴파일러로 컴파일 되었기 때문에 윈도우에서만 실행되는 실행 파일이다. 리눅스 운영체제에서는 실행되지 않는다. 즉 **C/C++의 경우 컴파일 플렛폼과 타겟 플렛폼이 다른 경우 프로그램이 동작하지 않는다**

![[Pasted image 20231004110225.png]]

>Java의 경우 컴파일 하면 바이트 코드인 .class 파일이 생성된다. 이 바이트 코드를 각자의 플렛폼에 설치되어있는 JVM이 운영체제에 맞는 실행파일로 바꿔준다. 
>Java에서 컴파일된 바이트 코드는 어떤 JVM에서도 동작하기 때문에 플렛폼에 종속적이지 않지만 **JVM은 플렛폼에 의존적**이다. 윈도우의 JVM과 리눅스의 JVM은 서로 다르다. 
>자바로 작성된 프로그램은 JVM에서만 실행된다.

## 바이트 코드를 읽는 방식
>JVM은 바이트 코드를 명령어 단위로 읽어서 해석하는데 Interpreter 방식과 JIT 컴파일 방식 두가지를 혼합하여 사용한다.
>Interpreter 방식은 초기 방식으로 속도가 느리다는 단점이 있다
>이런 느린 방식을 보완하기 위해 나온 것이 JIT(Just In Time) 컴파일 방식이다. 바이트 코드를 JIT 컴파일러를 이용해 프로그램을 실제 실행하는 시점에 각 OS에 맞는 Native Code로 변환하여 실행 속도를 개선했다
>하지만, 바이트코드를 Native Code로 변환하는 데에도 비용이 소요되므로, JVM은 모든 코드를 JIT 컴파일러 방식으로 실행하지 않고, 인터프리터 방식을 사용하다가 일정 기준이 넘어가면 JIT 컴파일 방식으로 명령어를 실행한다.

### JIT(Just In Time) 컴파일러
![[Pasted image 20231004113303.png]]

> 기존의 자바는 인터프리터 방식으로 명령어를 하나씩 실행하게끔 이루어져 있어 실행 속도가 느렸습니다. 하지만 하드웨어가 발전하면서 자바 컴파일러도 JIT 컴파일러 방식으로 개선되어 속도적인 측면에서 상당한 개선을 이루었습니다. JVM은 JIT(Just In Time) 컴파일러라고 합니다. 또한, JIT 컴파일러는 같은 코드를 매번 해석하지 않고, 실행할 때 컴파일을 하면서 해당 코드를 캐싱해버립니다. 이후에는 바뀐 부분만 컴파일하고, 나머지는 캐싱된 코드를 사용합니다. 이렇게 JIT 컴파일러는 운영체제에 맞게 바이트 실행 코드로 한 번에 변환하여 실행하기 때문에 이전의 자바 해석기(Java interpreter) 방식보다 성능이 10배 ~ 20배 정도 더 좋습니다.

## 성능
>바이트코드는 실제의 기계에서 직접 실행되는 것이 아니라 JVM의 해석 단계를 거쳐 실행되므로 [[Java]]로 개발된 프로그램은 같은 기능의 네이티브 언어보다 실행 속도가 느리다.
>JVM은 추상적인 머신이며, 메모리의 접근을 가상 머신 차원에서 관리하고 있으므로 런타임에 최적화가 가능하다. 매우 극단적이고 특수한 상황을 가정하면 극히 일부 기능에 대해서는 네이티브 언어보다 더 우월한 성능을 보여 주기도 한다. 하지만 JIT 컴파일 시간, 가비지 컬렉션을 위한 시간 등이 필요하므로 근본적인 한계가 있다
## 참고
> - [자바 가상머신 JVM(Java Virtual Machine) 총정리](https://coding-factory.tistory.com/827)
> - 